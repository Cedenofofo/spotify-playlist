<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuneuptify - Autenticación</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 2rem;
        }
        .auth-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(29, 185, 84, 0.3);
            border-top: 4px solid #1db954;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .auth-message {
            font-size: 1.2rem;
            color: #ffffff;
            margin-bottom: 1rem;
        }
        .auth-error {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-spinner"></div>
        <div class="auth-message" id="auth-message">Procesando autenticación...</div>
        <div id="auth-error" class="auth-error" style="display: none;"></div>
    </div>

    <script>
        // Función para obtener parámetros de la URL
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Función para manejar errores
        function handleError(message) {
            document.getElementById('auth-message').textContent = 'Error en la autenticación';
            document.getElementById('auth-error').textContent = message;
            document.getElementById('auth-error').style.display = 'block';
        }

        // Función para redirigir al dashboard
        function redirectToDashboard(accessToken, expiresIn) {
            // Guardar el token en localStorage
            localStorage.setItem('spotify_access_token', accessToken);
            localStorage.setItem('spotify_token_expires', Date.now() + (expiresIn * 1000));
            
            // Redirigir al dashboard
            window.location.href = 'dashboard.html';
        }

        // Función principal de autenticación
        function handleAuthentication() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const error = urlParams.get('error');

            // Si hay un error
            if (error) {
                handleError('Error de autorización: ' + error);
                return;
            }

            // Si no hay código
            if (!code) {
                handleError('No se recibió el código de autorización');
                return;
            }

            // Simular el intercambio de código por token
            // En un entorno real, esto se haría en el servidor
            document.getElementById('auth-message').textContent = 'Intercambiando código por token...';
            
            // Simular un delay para mostrar el proceso
            setTimeout(() => {
                // Por ahora, vamos a redirigir directamente al dashboard
                // En producción, necesitarías hacer una llamada al servidor
                document.getElementById('auth-message').textContent = 'Redirigiendo al dashboard...';
                
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1000);
            }, 2000);
        }

        // Ejecutar cuando la página cargue
        document.addEventListener('DOMContentLoaded', handleAuthentication);
    </script>
</body>
</html> 