<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Autenticaci√≥n Spotify</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .debug-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #27ae60;
            color: white;
        }
        .status.error {
            background: #e74c3c;
            color: white;
        }
        .status.warning {
            background: #f39c12;
            color: white;
        }
        .status.info {
            background: #3498db;
            color: white;
        }
        .test-button {
            background: #1db954;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #1ed760;
        }
        pre {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Debug - Autenticaci√≥n Spotify</h1>
    
    <div class="debug-section">
        <h2>üìã Estado de Configuraci√≥n</h2>
        <div id="config-status"></div>
    </div>

    <div class="debug-section">
        <h2>üîë Tokens de Acceso</h2>
        <div id="token-status"></div>
    </div>

    <div class="debug-section">
        <h2>üåê URLs y Redirecciones</h2>
        <div id="url-status"></div>
    </div>

    <div class="debug-section">
        <h2>üß™ Pruebas de Funcionalidad</h2>
        <button class="test-button" onclick="testLogin()">Probar Login</button>
        <button class="test-button" onclick="testLogout()">Probar Logout</button>
        <button class="test-button" onclick="testTokenRefresh()">Probar Refresh Token</button>
        <button class="test-button" onclick="clearAllData()">Limpiar Datos</button>
    </div>

    <div class="debug-section">
        <h2>üìä Informaci√≥n del Sistema</h2>
        <div id="system-info"></div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        function checkConfig() {
            const statusDiv = document.getElementById('config-status');
            let html = '';

            if (window.config) {
                html += '<div class="status success">‚úÖ Configuraci√≥n cargada correctamente</div>';
                html += '<pre>' + JSON.stringify(window.config, null, 2) + '</pre>';
            } else {
                html += '<div class="status error">‚ùå Configuraci√≥n no encontrada</div>';
            }

            statusDiv.innerHTML = html;
        }

        function checkTokens() {
            const statusDiv = document.getElementById('token-status');
            let html = '';

            const accessToken = localStorage.getItem('spotify_access_token');
            const refreshToken = localStorage.getItem('spotify_refresh_token');
            const tokenExpires = localStorage.getItem('spotify_token_expires');
            const authState = localStorage.getItem('spotify_auth_state');

            if (accessToken) {
                html += '<div class="status success">‚úÖ Token de acceso encontrado</div>';
                html += '<div class="status info">Token: ' + accessToken.substring(0, 20) + '...</div>';
            } else {
                html += '<div class="status error">‚ùå No hay token de acceso</div>';
            }

            if (refreshToken) {
                html += '<div class="status success">‚úÖ Token de refresh encontrado</div>';
            } else {
                html += '<div class="status warning">‚ö†Ô∏è No hay token de refresh</div>';
            }

            if (tokenExpires) {
                const expiresDate = new Date(parseInt(tokenExpires));
                const now = new Date();
                if (now < expiresDate) {
                    html += '<div class="status success">‚úÖ Token v√°lido (expira: ' + expiresDate.toLocaleString() + ')</div>';
                } else {
                    html += '<div class="status error">‚ùå Token expirado (expir√≥: ' + expiresDate.toLocaleString() + ')</div>';
                }
            } else {
                html += '<div class="status error">‚ùå No hay fecha de expiraci√≥n</div>';
            }

            if (authState) {
                html += '<div class="status info">Estado de autenticaci√≥n: ' + authState + '</div>';
            } else {
                html += '<div class="status warning">‚ö†Ô∏è No hay estado de autenticaci√≥n</div>';
            }

            statusDiv.innerHTML = html;
        }

        function checkURLs() {
            const statusDiv = document.getElementById('url-status');
            let html = '';

            html += '<div class="status info">Hostname: ' + window.location.hostname + '</div>';
            html += '<div class="status info">Protocolo: ' + window.location.protocol + '</div>';
            html += '<div class="status info">URL actual: ' + window.location.href + '</div>';

            if (window.config) {
                html += '<div class="status info">Redirect URI: ' + window.config.redirectUri + '</div>';
                html += '<div class="status info">Es GitHub Pages: ' + window.config.isGitHubPages + '</div>';
            }

            statusDiv.innerHTML = html;
        }

        function checkSystemInfo() {
            const statusDiv = document.getElementById('system-info');
            let html = '';

            html += '<div class="status info">Navegador: ' + navigator.userAgent + '</div>';
            html += '<div class="status info">Cookies habilitadas: ' + navigator.cookieEnabled + '</div>';
            html += '<div class="status info">LocalStorage disponible: ' + (typeof(Storage) !== "undefined") + '</div>';
            html += '<div class="status info">SessionStorage disponible: ' + (typeof(Storage) !== "undefined") + '</div>';

            statusDiv.innerHTML = html;
        }

        function testLogin() {
            if (window.auth) {
                window.auth.login();
            } else {
                alert('Clase Auth no disponible');
            }
        }

        function testLogout() {
            if (window.auth) {
                window.auth.logout();
            } else {
                alert('Clase Auth no disponible');
            }
        }

        function testTokenRefresh() {
            // Implementar prueba de refresh token
            alert('Funci√≥n de refresh token no implementada en debug');
        }

        function clearAllData() {
            localStorage.clear();
            sessionStorage.clear();
            alert('Datos limpiados. Recargando p√°gina...');
            location.reload();
        }

        // Ejecutar todas las verificaciones
        function runAllChecks() {
            checkConfig();
            checkTokens();
            checkURLs();
            checkSystemInfo();
        }

        // Ejecutar cuando la p√°gina cargue
        document.addEventListener('DOMContentLoaded', () => {
            runAllChecks();
            
            // Crear instancia de Auth para pruebas
            window.auth = new Auth();
        });

        // Actualizar cada 5 segundos
        setInterval(runAllChecks, 5000);
    </script>
</body>
</html> 