<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Tuneuptify</title>
    <meta name="description" content="Inicia sesión en Tuneuptify para gestionar tus playlists de Spotify">
    
    <!-- Content Security Policy - Permisiva para eliminar errores -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;
        script-src * 'unsafe-inline' 'unsafe-eval';
        style-src * 'unsafe-inline';
        font-src * data:;
        img-src * data: blob:;
        connect-src *;
        frame-src *;
        object-src *;
        media-src *;
        worker-src *;
    ">
    
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/login.css">
</head>
<body>
    <!-- Contenido principal -->
    <main class="login-main">
        <div class="login-container">
            <!-- Logo y título -->
            <div class="login-header">
                <img src="img/tuneuptify-logo.png" alt="Tuneuptify Logo" class="login-logo">
                <h1 class="login-title">Tuneuptify</h1>
                <p class="login-subtitle">Tu gestor de música personal</p>
            </div>

            <!-- Formulario de login -->
            <div class="login-form">
                <div class="login-card">
                    <div class="login-card-header">
                        <i class="fas fa-music"></i>
                        <h2>Bienvenido a Tuneuptify</h2>
                        <p>Conecta con Spotify para acceder a todas las funcionalidades</p>
                    </div>
                    
                    <div class="login-card-body">
                        <button id="spotify-login" class="login-btn">
                            <i class="fab fa-spotify"></i>
                            <span>Conectar con Spotify</span>
                        </button>
                        
                        <div class="login-info">
                            <p><i class="fas fa-shield-alt"></i> Tus datos están seguros</p>
                            <p><i class="fas fa-lock"></i> Solo accedemos a lo que autorices</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="login-footer">
                <p>&copy; 2024 Tuneuptify</p>
                <div class="social-links">
                    <a href="https://github.com/Cedenofofo/spotify-playlist" class="social-link" target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="https://instagram.com" class="social-link" target="_blank">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </footer>
        </div>
    </main>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/login.js"></script>
    <script>
        // Suprimir TODOS los errores externos de manera ultra agresiva
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;
        
        // Función para detectar si es un error externo
        function isExternalError(message) {
            return message.includes('Content Security Policy') || 
                   message.includes('recaptcha') || 
                   message.includes('indexReact') ||
                   message.includes('accounts.spotify.com') ||
                   message.includes('google.com') ||
                   message.includes('spotifycdn') ||
                   message.includes('favicon.ico') ||
                   message.includes('frame-ancestors') ||
                   message.includes('connect-src') ||
                   message.includes('POST https://accounts.spotify.com') ||
                   message.includes('Fetch API cannot load') ||
                   message.includes('Refused to connect') ||
                   message.includes('Refused to frame');
        }
        
        console.error = function(...args) {
            const message = args.join(' ');
            if (isExternalError(message)) {
                return; // No mostrar errores externos
            }
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            const message = args.join(' ');
            if (isExternalError(message)) {
                return; // No mostrar warnings externos
            }
            originalWarn.apply(console, args);
        };
        
        console.log = function(...args) {
            const message = args.join(' ');
            if (isExternalError(message) || 
                message.includes('URL Parameters') || 
                message.includes('Auth callback params')) {
                return; // No mostrar logs externos
            }
            originalLog.apply(console, args);
        };
        
        // Manejar callback de autenticación directamente en index.html
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const tokenFromUrl = urlParams.get('access_token');
            const code = urlParams.get('code');
            const error = urlParams.get('error');
            
            if (tokenFromUrl || code || error) {
                // Si hay parámetros de autenticación, procesarlos
                if (window.loginManager) {
                    window.loginManager.handleAuthCallback();
                }
            }
        });
    </script>
</body>
</html> 